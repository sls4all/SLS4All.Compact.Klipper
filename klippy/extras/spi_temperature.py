# Support for common SPI based thermocouple and RTD temperature sensors
#
# Copyright (C) 2018  Petri Honkala <cruwaller@gmail.com>
# Copyright (C) 2018  Kevin O'Connor <kevin@koconnor.net>
#
# This file may be distributed under the terms of the GNU GPLv3 license.
import math
from . import bus


######################################################################
# SensorBase
######################################################################

REPORT_TIME = 0.300

class SensorBase:
    def __init__(self, config, chip_type, config_cmd=None, spi_mode=1, channel=0, speed=4000000):
        self.printer = config.get_printer()
        self.chip_type = chip_type
        self._callback = None
        self.min_sample_value = self.max_sample_value = 0
        self._report_clock = 0
        self.channel = channel
        self.spi = bus.MCU_SPI_from_config(
            config, spi_mode, pin_option="sensor_pin", default_speed=speed)
        if config_cmd is not None:
            self.spi.spi_send(config_cmd)
        self.mcu = mcu = self.spi.get_mcu()
        # Reader chip configuration
        self.oid = oid = mcu.create_oid()
        mcu.register_response(self._handle_spi_response,
                              "thermocouple_result", oid)
        mcu.register_config_callback(self._build_config)
    def setup_minmax(self, min_temp, max_temp):
        adc_range = [self.calc_adc(min_temp), self.calc_adc(max_temp)]
        self.min_sample_value = min(adc_range)
        self.max_sample_value = max(adc_range)
    def setup_callback(self, cb):
        self._callback = cb
    def get_report_time_delta(self):
        return REPORT_TIME
    def _build_config(self):
        self.mcu.add_config_cmd(
            "config_thermocouple oid=%u spi_oid=%u thermocouple_type=%s channel=%u" % (
                self.oid, self.spi.get_oid(), self.chip_type, self.channel))
        clock = self.mcu.get_query_slot(self.oid)
        self._report_clock = self.mcu.seconds_to_clock(REPORT_TIME)
        self.mcu.add_config_cmd(
            "query_thermocouple oid=%u clock=%u rest_ticks=%u"
            " min_value=%u max_value=%u" % (
                self.oid, clock, self._report_clock,
                self.min_sample_value, self.max_sample_value), is_init=True)
    def _handle_spi_response(self, params):
        temp = self.calc_temp(params['value'], params['fault'])
        next_clock      = self.mcu.clock32_to_clock64(params['next_clock'])
        last_read_clock = next_clock - self._report_clock
        last_read_time  = self.mcu.clock_to_print_time(last_read_clock)
        self._callback(last_read_time, temp)
    def fault(self, msg):
        self.printer.invoke_async_shutdown(msg)


######################################################################
# MAX31856 thermocouple
######################################################################

MAX31856_CR0_REG           = 0x00
MAX31856_CR0_AUTOCONVERT   = 0x80
MAX31856_CR0_1SHOT         = 0x40
MAX31856_CR0_OCFAULT1      = 0x20
MAX31856_CR0_OCFAULT0      = 0x10
MAX31856_CR0_CJ            = 0x08
MAX31856_CR0_FAULT         = 0x04
MAX31856_CR0_FAULTCLR      = 0x02
MAX31856_CR0_FILT50HZ      = 0x01
MAX31856_CR0_FILT60HZ      = 0x00

MAX31856_CR1_REG           = 0x01
MAX31856_CR1_AVGSEL1       = 0x00
MAX31856_CR1_AVGSEL2       = 0x10
MAX31856_CR1_AVGSEL4       = 0x20
MAX31856_CR1_AVGSEL8       = 0x30
MAX31856_CR1_AVGSEL16      = 0x70

MAX31856_MASK_REG                          = 0x02
MAX31856_MASK_COLD_JUNCTION_HIGH_FAULT     = 0x20
MAX31856_MASK_COLD_JUNCTION_LOW_FAULT      = 0x10
MAX31856_MASK_THERMOCOUPLE_HIGH_FAULT      = 0x08
MAX31856_MASK_THERMOCOUPLE_LOW_FAULT       = 0x04
MAX31856_MASK_VOLTAGE_UNDER_OVER_FAULT     = 0x02
MAX31856_MASK_THERMOCOUPLE_OPEN_FAULT      = 0x01

MAX31856_CJHF_REG          = 0x03
MAX31856_CJLF_REG          = 0x04
MAX31856_LTHFTH_REG        = 0x05
MAX31856_LTHFTL_REG        = 0x06
MAX31856_LTLFTH_REG        = 0x07
MAX31856_LTLFTL_REG        = 0x08
MAX31856_CJTO_REG          = 0x09
MAX31856_CJTH_REG          = 0x0A
MAX31856_CJTL_REG          = 0x0B
MAX31856_LTCBH_REG         = 0x0C
MAX31856_LTCBM_REG         = 0x0D
MAX31856_LTCBL_REG         = 0x0E

MAX31856_SR_REG            = 0x0F
MAX31856_FAULT_CJRANGE     = 0x80  # Cold Junction out of range
MAX31856_FAULT_TCRANGE     = 0x40  # Thermocouple out of range
MAX31856_FAULT_CJHIGH      = 0x20  # Cold Junction High
MAX31856_FAULT_CJLOW       = 0x10  # Cold Junction Low
MAX31856_FAULT_TCHIGH      = 0x08  # Thermocouple Low
MAX31856_FAULT_TCLOW       = 0x04  # Thermocouple Low
MAX31856_FAULT_OVUV        = 0x02  # Under Over Voltage
MAX31856_FAULT_OPEN        = 0x01

MAX31856_SCALE = 5
MAX31856_MULT = 0.0078125

class MAX31856(SensorBase):
    def __init__(self, config):
        SensorBase.__init__(self, config, "MAX31856",
                            self.build_spi_init(config))
    def calc_temp(self, adc, fault):
        if fault & MAX31856_FAULT_CJRANGE:
            self.fault("Max31856: Cold Junction Range Fault")
        if fault & MAX31856_FAULT_TCRANGE:
            self.fault("Max31856: Thermocouple Range Fault")
        if fault & MAX31856_FAULT_CJHIGH:
            self.fault("Max31856: Cold Junction High Fault")
        if fault & MAX31856_FAULT_CJLOW:
            self.fault("Max31856: Cold Junction Low Fault")
        if fault & MAX31856_FAULT_TCHIGH:
            self.fault("Max31856: Thermocouple High Fault")
        if fault & MAX31856_FAULT_TCLOW:
            self.fault("Max31856: Thermocouple Low Fault")
        if fault & MAX31856_FAULT_OVUV:
            self.fault("Max31856: Over/Under Voltage Fault")
        if fault & MAX31856_FAULT_OPEN:
            self.fault("Max31856: Thermocouple Open Fault")
        adc = adc >> MAX31856_SCALE
        # Fix sign bit:
        if adc & 0x40000:
            adc = ((adc & 0x3FFFF) + 1) * -1
        temp = MAX31856_MULT * adc
        return temp
    def calc_adc(self, temp):
        adc = int( ( temp / MAX31856_MULT ) + 0.5 ) # convert to ADC value
        adc = adc << MAX31856_SCALE
        return adc
    def build_spi_init(self, config):
        cmds = []
        value = MAX31856_CR0_AUTOCONVERT
        if config.getboolean('tc_use_50Hz_filter', False):
            value |= MAX31856_CR0_FILT50HZ
        cmds.append(0x80 + MAX31856_CR0_REG)
        cmds.append(value)

        types = {
            "B" : 0b0000,
            "E" : 0b0001,
            "J" : 0b0010,
            "K" : 0b0011,
            "N" : 0b0100,
            "R" : 0b0101,
            "S" : 0b0110,
            "T" : 0b0111,
        }
        value = config.getchoice('tc_type', types, default="K")
        averages = {
            "1"  : MAX31856_CR1_AVGSEL1,
            "2"  : MAX31856_CR1_AVGSEL2,
            "4"  : MAX31856_CR1_AVGSEL4,
            "8"  : MAX31856_CR1_AVGSEL8,
            "16" : MAX31856_CR1_AVGSEL16
        }
        value |= config.getchoice('tc_averaging_count', averages, "1")
        cmds.append(0x80 + MAX31856_CR1_REG)
        cmds.append(value)

        value = (MAX31856_MASK_VOLTAGE_UNDER_OVER_FAULT |
                 MAX31856_MASK_THERMOCOUPLE_OPEN_FAULT)
        cmds.append(0x80 + MAX31856_MASK_REG)
        cmds.append(value)
        return cmds


######################################################################
# MAX31855 thermocouple
######################################################################

MAX31855_SCALE = 18
MAX31855_MULT = 0.25

class MAX31855(SensorBase):
    def __init__(self, config):
        SensorBase.__init__(self, config, "MAX31855", spi_mode=0)
    def calc_temp(self, adc, fault):
        if adc & 0x1:
            self.fault("MAX31855 : Open Circuit")
        if adc & 0x2:
            self.fault("MAX31855 : Short to GND")
        if adc & 0x4:
            self.fault("MAX31855 : Short to Vcc")
        adc = adc >> MAX31855_SCALE
        # Fix sign bit:
        if adc & 0x2000:
            adc = ((adc & 0x1FFF) + 1) * -1
        temp = MAX31855_MULT * adc
        return temp
    def calc_adc(self, temp):
        adc = int( ( temp / MAX31855_MULT ) + 0.5 ) # convert to ADC value
        adc = adc << MAX31855_SCALE
        return adc


######################################################################
# MAX6675 thermocouple
######################################################################

MAX6675_SCALE = 3
MAX6675_MULT = 0.25

class MAX6675(SensorBase):
    def __init__(self, config):
        SensorBase.__init__(self, config, "MAX6675", spi_mode=0)
    def calc_temp(self, adc, fault):
        if adc & 0x02:
            self.fault("Max6675 : Device ID error")
        if adc & 0x04:
            self.fault("Max6675 : Thermocouple Open Fault")
        adc = adc >> MAX6675_SCALE
        # Fix sign bit:
        if adc & 0x2000:
            adc = ((adc & 0x1FFF) + 1) * -1
        temp = MAX6675_MULT * adc
        return temp
    def calc_adc(self, temp):
        adc = int( ( temp / MAX6675_MULT ) + 0.5 ) # convert to ADC value
        adc = adc << MAX6675_SCALE
        return adc


######################################################################
# MAX31865 (RTD sensor)
######################################################################

MAX31865_CONFIG_REG            = 0x00
MAX31865_RTDMSB_REG            = 0x01
MAX31865_RTDLSB_REG            = 0x02
MAX31865_HFAULTMSB_REG         = 0x03
MAX31865_HFAULTLSB_REG         = 0x04
MAX31865_LFAULTMSB_REG         = 0x05
MAX31865_LFAULTLSB_REG         = 0x06
MAX31865_FAULTSTAT_REG         = 0x07

MAX31865_CONFIG_BIAS           = 0x80
MAX31865_CONFIG_MODEAUTO       = 0x40
MAX31865_CONFIG_1SHOT          = 0x20
MAX31865_CONFIG_3WIRE          = 0x10
MAX31865_CONFIG_FAULTCLEAR     = 0x02
MAX31865_CONFIG_FILT50HZ       = 0x01

MAX31865_FAULT_HIGHTHRESH      = 0x80
MAX31865_FAULT_LOWTHRESH       = 0x40
MAX31865_FAULT_REFINLOW        = 0x20
MAX31865_FAULT_REFINHIGH       = 0x10
MAX31865_FAULT_RTDINLOW        = 0x08
MAX31865_FAULT_OVUV            = 0x04

MAX31865_ADC_MAX = 1<<15

# Callendar-Van Dusen constants for platinum resistance thermometers (RTD)
CVD_A = 3.9083e-3
CVD_B = -5.775e-7

class MAX31865(SensorBase):
    def __init__(self, config):
        rtd_nominal_r = config.getfloat('rtd_nominal_r', 100., above=0.)
        rtd_reference_r = config.getfloat('rtd_reference_r', 430., above=0.)
        adc_to_resist = rtd_reference_r / float(MAX31865_ADC_MAX)
        self.adc_to_resist_div_nominal = adc_to_resist / rtd_nominal_r
        SensorBase.__init__(self, config, "MAX31865",
                            self.build_spi_init(config))
    def calc_temp(self, adc, fault):
        if fault & 0x80:
            self.fault("Max31865 RTD input is disconnected")
        if fault & 0x40:
            self.fault("Max31865 RTD input is shorted")
        if fault & 0x20:
            self.fault(
                "Max31865 VREF- is greater than 0.85 * VBIAS, FORCE- open")
        if fault & 0x10:
            self.fault("Max31865 VREF- is less than 0.85 * VBIAS, FORCE- open")
        if fault & 0x08:
            self.fault("Max31865 VRTD- is less than 0.85 * VBIAS, FORCE- open")
        if fault & 0x04:
            self.fault("Max31865 Overvoltage or undervoltage fault")
        if fault & 0x03:
            self.fault("Max31865 Unspecified error")
        adc = adc >> 1 # remove fault bit
        R_div_nominal = adc * self.adc_to_resist_div_nominal
        # Resistance (relative to rtd_nominal_r) is calculated using:
        #  R_div_nominal = 1. + CVD_A * temp + CVD_B * temp**2
        # Solve for temp using quadratic equation:
        #  temp = (-b +- sqrt(b**2 - 4ac)) / 2a
        discriminant = math.sqrt(CVD_A**2 - 4. * CVD_B * (1. - R_div_nominal))
        temp = (-CVD_A + discriminant) / (2. * CVD_B)
        return temp
    def calc_adc(self, temp):
        # Calculate relative resistance via Callendar-Van Dusen formula:
        #  resistance = rtd_nominal_r * (1 + CVD_A * temp + CVD_B * temp**2)
        R_div_nominal = 1. + CVD_A * temp + CVD_B * temp * temp
        adc = int(R_div_nominal / self.adc_to_resist_div_nominal + 0.5)
        adc = max(0, min(MAX31865_ADC_MAX, adc))
        adc = adc << 1 # Add fault bit
        return adc
    def build_spi_init(self, config):
        value = (MAX31865_CONFIG_BIAS |
                 MAX31865_CONFIG_MODEAUTO |
                 MAX31865_CONFIG_FAULTCLEAR)
        if config.getboolean('rtd_use_50Hz_filter', False):
            value |= MAX31865_CONFIG_FILT50HZ
        if config.getint('rtd_num_of_wires', 2) == 3:
            value |= MAX31865_CONFIG_3WIRE
        cmd = 0x80 + MAX31865_CONFIG_REG
        return [cmd, value]
        
######################################################################
# InovaV1 (MCP3204 4k7)
######################################################################

class InovaV1(SensorBase):
    def __init__(self, config):
        self.tempTable = [-30, -29.75, -29.5, -29.25, -29, -28.75, -28.5, -28.25, -28, -27.75, -27.5, -27.25, -27, -26.75, -26.5, -26.25, -26, -25.75, -25.5, -25.25, -25, -24.75, -24.5, -24.25, -24, -23.75, -23.5, -23.25, -23, -22.75, -22.5, -22.25, -22, -21.75, -21.5, -21.25, -21, -20.75, -20.5, -20.25, -20, -19.75, -19.5, -19.25, -19, -18.75, -18.5, -18.25, -18, -17.75, -17.5, -17.25, -17, -16.75, -16.5, -16.25, -16, -15.75, -15.5, -15.25, -15, -14.75, -14.5, -14.25, -14, -13.75, -13.5, -13.25, -13, -12.75, -12.5, -12.25, -12, -11.75, -11.5, -11.25, -11, -10.75, -10.5, -10.25, -10, -9.75, -9.5, -9.25, -9, -8.75, -8.5, -8.25, -8, -7.75, -7.5, -7.25, -7, -6.75, -6.5, -6.25, -6, -5.75, -5.5, -5.25, -5, -4.75, -4.5, -4.25, -4, -3.75, -3.5, -3.25, -3, -2.75, -2.5, -2.25, -2, -1.75, -1.5, -1.25, -1, -0.75, -0.5, -0.25, 0, 0.25, 0.5, 0.75, 1, 1.25, 1.5, 1.75, 2, 2.25, 2.5, 2.75, 3, 3.25, 3.5, 3.75, 4, 4.25, 4.5, 4.75, 5, 5.25, 5.5, 5.75, 6, 6.25, 6.5, 6.75, 7, 7.25, 7.5, 7.75, 8, 8.25, 8.5, 8.75, 9, 9.25, 9.5, 9.75, 10, 10.25, 10.5, 10.75, 11, 11.25, 11.5, 11.75, 12, 12.25, 12.5, 12.75, 13, 13.25, 13.5, 13.75, 14, 14.25, 14.5, 14.75, 15, 15.25, 15.5, 15.75, 16, 16.25, 16.5, 16.75, 17, 17.25, 17.5, 17.75, 18, 18.25, 18.5, 18.75, 19, 19.25, 19.5, 19.75, 20, 20.25, 20.5, 20.75, 21, 21.25, 21.5, 21.75, 22, 22.25, 22.5, 22.75, 23, 23.25, 23.5, 23.75, 24, 24.25, 24.5, 24.75, 25, 25.25, 25.5, 25.75, 26, 26.25, 26.5, 26.75, 27, 27.25, 27.5, 27.75, 28, 28.25, 28.5, 28.75, 29, 29.25, 29.5, 29.75, 30, 30.25, 30.5, 30.75, 31, 31.25, 31.5, 31.75, 32, 32.25, 32.5, 32.75, 33, 33.25, 33.5, 33.75, 34, 34.25, 34.5, 34.75, 35, 35.25, 35.5, 35.75, 36, 36.25, 36.5, 36.75, 37, 37.25, 37.5, 37.75, 38, 38.25, 38.5, 38.75, 39, 39.25, 39.5, 39.75, 40, 40.25, 40.5, 40.75, 41, 41.25, 41.5, 41.75, 42, 42.25, 42.5, 42.75, 43, 43.25, 43.5, 43.75, 44, 44.25, 44.5, 44.75, 45, 45.25, 45.5, 45.75, 46, 46.25, 46.5, 46.75, 47, 47.25, 47.5, 47.75, 48, 48.25, 48.5, 48.75, 49, 49.25, 49.5, 49.75, 50, 50.25, 50.5, 50.75, 51, 51.25, 51.5, 51.75, 52, 52.25, 52.5, 52.75, 53, 53.25, 53.5, 53.75, 54, 54.25, 54.5, 54.75, 55, 55.25, 55.5, 55.75, 56, 56.25, 56.5, 56.75, 57, 57.25, 57.5, 57.75, 58, 58.25, 58.5, 58.75, 59, 59.25, 59.5, 59.75, 60, 60.25, 60.5, 60.75, 61, 61.25, 61.5, 61.75, 62, 62.25, 62.5, 62.75, 63, 63.25, 63.5, 63.75, 64, 64.25, 64.5, 64.75, 65, 65.25, 65.5, 65.75, 66, 66.25, 66.5, 66.75, 67, 67.25, 67.5, 67.75, 68, 68.25, 68.5, 68.75, 69, 69.25, 69.5, 69.75, 70, 70.25, 70.5, 70.75, 71, 71.25, 71.5, 71.75, 72, 72.25, 72.5, 72.75, 73, 73.25, 73.5, 73.75, 74, 74.25, 74.5, 74.75, 75, 75.25, 75.5, 75.75, 76, 76.25, 76.5, 76.75, 77, 77.25, 77.5, 77.75, 78, 78.25, 78.5, 78.75, 79, 79.25, 79.5, 79.75, 80, 80.25, 80.5, 80.75, 81, 81.25, 81.5, 81.75, 82, 82.25, 82.5, 82.75, 83, 83.25, 83.5, 83.75, 84, 84.25, 84.5, 84.75, 85, 85.25, 85.5, 85.75, 86, 86.25, 86.5, 86.75, 87, 87.25, 87.5, 87.75, 88, 88.25, 88.5, 88.75, 89, 89.25, 89.5, 89.75, 90, 90.25, 90.5, 90.75, 91, 91.25, 91.5, 91.75, 92, 92.25, 92.5, 92.75, 93, 93.25, 93.5, 93.75, 94, 94.25, 94.5, 94.75, 95, 95.25, 95.5, 95.75, 96, 96.25, 96.5, 96.75, 97, 97.25, 97.5, 97.75, 98, 98.25, 98.5, 98.75, 99, 99.25, 99.5, 99.75, 100, 100.25, 100.5, 100.75, 101, 101.25, 101.5, 101.75, 102, 102.25, 102.5, 102.75, 103, 103.25, 103.5, 103.75, 104, 104.25, 104.5, 104.75, 105, 105.25, 105.5, 105.75, 106, 106.25, 106.5, 106.75, 107, 107.25, 107.5, 107.75, 108, 108.25, 108.5, 108.75, 109, 109.25, 109.5, 109.75, 110, 110.25, 110.5, 110.75, 111, 111.25, 111.5, 111.75, 112, 112.25, 112.5, 112.75, 113, 113.25, 113.5, 113.75, 114, 114.25, 114.5, 114.75, 115, 115.25, 115.5, 115.75, 116, 116.25, 116.5, 116.75, 117, 117.25, 117.5, 117.75, 118, 118.25, 118.5, 118.75, 119, 119.25, 119.5, 119.75, 120, 120.25, 120.5, 120.75, 121, 121.25, 121.5, 121.75, 122, 122.25, 122.5, 122.75, 123, 123.25, 123.5, 123.75, 124, 124.25, 124.5, 124.75, 125, 125.25, 125.5, 125.75, 126, 126.25, 126.5, 126.75, 127, 127.25, 127.5, 127.75, 128, 128.25, 128.5, 128.75, 129, 129.25, 129.5, 129.75, 130, 130.25, 130.5, 130.75, 131, 131.25, 131.5, 131.75, 132, 132.25, 132.5, 132.75, 133, 133.25, 133.5, 133.75, 134, 134.25, 134.5, 134.75, 135, 135.25, 135.5, 135.75, 136, 136.25, 136.5, 136.75, 137, 137.25, 137.5, 137.75, 138, 138.25, 138.5, 138.75, 139, 139.25, 139.5, 139.75, 140, 140.25, 140.5, 140.75, 141, 141.25, 141.5, 141.75, 142, 142.25, 142.5, 142.75, 143, 143.25, 143.5, 143.75, 144, 144.25, 144.5, 144.75, 145, 145.25, 145.5, 145.75, 146, 146.25, 146.5, 146.75, 147, 147.25, 147.5, 147.75, 148, 148.25, 148.5, 148.75, 149, 149.25, 149.5, 149.75, 150, 150.25, 150.5, 150.75, 151, 151.25, 151.5, 151.75, 152, 152.25, 152.5, 152.75, 153, 153.25, 153.5, 153.75, 154, 154.25, 154.5, 154.75, 155, 155.25, 155.5, 155.75, 156, 156.25, 156.5, 156.75, 157, 157.25, 157.5, 157.75, 158, 158.25, 158.5, 158.75, 159, 159.25, 159.5, 159.75, 160, 160.25, 160.5, 160.75, 161, 161.25, 161.5, 161.75, 162, 162.25, 162.5, 162.75, 163, 163.25, 163.5, 163.75, 164, 164.25, 164.5, 164.75, 165, 165.25, 165.5, 165.75, 166, 166.25, 166.5, 166.75, 167, 167.25, 167.5, 167.75, 168, 168.25, 168.5, 168.75, 169, 169.25, 169.5, 169.75, 170, 170.25, 170.5, 170.75, 171, 171.25, 171.5, 171.75, 172, 172.25, 172.5, 172.75, 173, 173.25, 173.5, 173.75, 174, 174.25, 174.5, 174.75, 175, 175.25, 175.5, 175.75, 176, 176.25, 176.5, 176.75, 177, 177.25, 177.5, 177.75, 178, 178.25, 178.5, 178.75, 179, 179.25, 179.5, 179.75, 180, 180.25, 180.5, 180.75, 181, 181.25, 181.5, 181.75, 182, 182.25, 182.5, 182.75, 183, 183.25, 183.5, 183.75, 184, 184.25, 184.5, 184.75, 185, 185.25, 185.5, 185.75, 186, 186.25, 186.5, 186.75, 187, 187.25, 187.5, 187.75, 188, 188.25, 188.5, 188.75, 189, 189.25, 189.5, 189.75, 190, 190.25, 190.5, 190.75, 191, 191.25, 191.5, 191.75, 192, 192.25, 192.5, 192.75, 193, 193.25, 193.5, 193.75, 194, 194.25, 194.5, 194.75, 195, 195.25, 195.5, 195.75, 196, 196.25, 196.5, 196.75, 197, 197.25, 197.5, 197.75, 198, 198.25, 198.5, 198.75, 199, 199.25, 199.5, 199.75, 200, 200.25, 200.5, 200.75, 201, 201.25, 201.5, 201.75, 202, 202.25, 202.5, 202.75, 203, 203.25, 203.5, 203.75, 204, 204.25, 204.5, 204.75, 205, 205.25, 205.5, 205.75, 206, 206.25, 206.5, 206.75, 207, 207.25, 207.5, 207.75, 208, 208.25, 208.5, 208.75, 209, 209.25, 209.5, 209.75, 210, 210.25, 210.5, 210.75, 211, 211.25, 211.5, 211.75, 212, 212.25, 212.5, 212.75, 213, 213.25, 213.5, 213.75, 214, 214.25, 214.5, 214.75, 215, 215.25, 215.5, 215.75, 216, 216.25, 216.5, 216.75, 217, 217.25, 217.5, 217.75, 218, 218.25, 218.5, 218.75, 219, 219.25, 219.5, 219.75, 220, 220.25, 220.5, 220.75, 221, 221.25, 221.5, 221.75, 222, 222.25, 222.5, 222.75, 223, 223.25, 223.5, 223.75, 224, 224.25, 224.5, 224.75, 225, 225.25, 225.5, 225.75, 226, 226.25, 226.5, 226.75, 227, 227.25, 227.5, 227.75, 228, 228.25, 228.5, 228.75, 229, 229.25, 229.5, 229.75, 230, 230.25, 230.5, 230.75, 231, 231.25, 231.5, 231.75, 232, 232.25, 232.5, 232.75, 233, 233.25, 233.5, 233.75, 234, 234.25, 234.5, 234.75, 235, 235.25, 235.5, 235.75, 236, 236.25, 236.5, 236.75, 237, 237.25, 237.5, 237.75, 238, 238.25, 238.5, 238.75, 239, 239.25, 239.5, 239.75, 240, 240.25, 240.5, 240.75, 241, 241.25, 241.5, 241.75, 242, 242.25, 242.5, 242.75, 243, 243.25, 243.5, 243.75, 244, 244.25, 244.5, 244.75, 245, 245.25, 245.5, 245.75, 246, 246.25, 246.5, 246.75, 247, 247.25, 247.5, 247.75, 248, 248.25, 248.5, 248.75, 249, 249.25, 249.5, 249.75, 250, 250.25, 250.5, 250.75, 251, 251.25, 251.5, 251.75, 252, 252.25, 252.5, 252.75, 253, 253.25, 253.5, 253.75, 254, 254.25, 254.5, 254.75, 255, 255.25, 255.5, 255.75, 256, 256.25, 256.5, 256.75, 257, 257.25, 257.5, 257.75, 258, 258.25, 258.5, 258.75, 259, 259.25, 259.5, 259.75, 260, 260.25, 260.5, 260.75, 261, 261.25, 261.5, 261.75, 262, 262.25, 262.5, 262.75, 263, 263.25, 263.5, 263.75, 264, 264.25, 264.5, 264.75, 265, 265.25, 265.5, 265.75, 266, 266.25, 266.5, 266.75, 267, 267.25, 267.5, 267.75, 268, 268.25, 268.5, 268.75, 269, 269.25, 269.5, 269.75, 270, 270.25, 270.5, 270.75, 271, 271.25, 271.5, 271.75, 272, 272.25, 272.5, 272.75, 273, 273.25, 273.5, 273.75, 274, 274.25, 274.5, 274.75, 275, 275.25, 275.5, 275.75, 276, 276.25, 276.5, 276.75, 277, 277.25, 277.5, 277.75, 278, 278.25, 278.5, 278.75, 279, 279.25, 279.5, 279.75, 280, 280.25, 280.5, 280.75, 281, 281.25, 281.5, 281.75, 282, 282.25, 282.5, 282.75, 283, 283.25, 283.5, 283.75, 284, 284.25, 284.5, 284.75, 285, 285.25, 285.5, 285.75, 286, 286.25, 286.5, 286.75, 287, 287.25, 287.5, 287.75, 288, 288.25, 288.5, 288.75, 289, 289.25, 289.5, 289.75, 290, 290.25, 290.5, 290.75, 291, 291.25, 291.5, 291.75, 292, 292.25, 292.5, 292.75, 293, 293.25, 293.5, 293.75, 294, 294.25, 294.5, 294.75, 295, 295.25, 295.5, 295.75, 296, 296.25, 296.5, 296.75, 297, 297.25, 297.5, 297.75, 298, 298.25, 298.5, 298.75, 299, 299.25, 299.5, 299.75, 300, ]
        self.resTable = [11.075, 11.241, 11.412, 11.589, 11.771, 11.946, 12.127, 12.313, 12.504, 12.689, 12.879, 13.075, 13.277, 13.472, 13.672, 13.878, 14.091, 14.295, 14.506, 14.723, 14.946, 15.163, 15.387, 15.617, 15.853, 16.082, 16.316, 16.558, 16.807, 17.047, 17.294, 17.548, 17.810, 18.062, 18.322, 18.589, 18.864, 19.129, 19.401, 19.682, 19.970, 20.249, 20.535, 20.830, 21.133, 21.426, 21.727, 22.036, 22.354, 22.661, 22.976, 23.301, 23.634, 23.956, 24.287, 24.627, 24.976, 25.314, 25.661, 26.017, 26.383, 26.742, 27.111, 27.490, 27.879, 28.255, 28.642, 29.039, 29.447, 29.841, 30.246, 30.662, 31.090, 31.502, 31.926, 32.362, 32.809, 33.241, 33.685, 34.141, 34.609, 35.062, 35.527, 36.004, 36.494, 36.967, 37.453, 37.952, 38.465, 38.960, 39.468, 39.990, 40.525, 41.043, 41.574, 42.119, 42.678, 43.219, 43.773, 44.342, 44.926, 45.501, 46.091, 46.696, 47.317, 47.918, 48.534, 49.166, 49.814, 50.441, 51.085, 51.744, 52.422, 53.076, 53.748, 54.436, 55.143, 55.826, 56.527, 57.245, 57.982, 58.698, 59.432, 60.185, 60.957, 61.704, 62.469, 63.254, 64.059, 64.838, 65.635, 66.453, 67.292, 68.103, 68.935, 69.787, 70.660, 71.505, 72.371, 73.258, 74.168, 75.051, 75.956, 76.882, 77.832, 78.752, 79.693, 80.658, 81.646, 82.603, 83.582, 84.585, 85.613, 86.609, 87.627, 88.671, 89.739, 90.774, 91.833, 92.917, 94.028, 95.123, 96.245, 97.394, 98.570, 99.709, 100.875, 102.069, 103.291, 104.476, 105.688, 106.928, 108.198, 109.429, 110.688, 111.976, 113.294, 114.573, 115.880, 117.217, 118.586, 119.911, 121.266, 122.652, 124.071, 125.446, 126.852, 128.290, 129.760, 131.187, 132.645, 134.136, 135.660, 137.139, 138.651, 140.196, 141.776, 143.309, 144.875, 146.476, 148.113, 149.722, 151.367, 153.048, 154.767, 156.434, 158.138, 159.879, 161.659, 163.386, 165.151, 166.954, 168.796, 170.584, 172.411, 174.276, 176.183, 178.033, 179.923, 181.853, 183.825, 185.679, 187.570, 189.501, 191.471, 193.385, 195.338, 197.331, 199.365, 201.341, 203.356, 205.412, 207.511, 209.550, 211.629, 213.750, 215.914, 218.017, 220.162, 222.349, 224.580, 226.814, 229.093, 231.418, 233.790, 236.095, 238.446, 240.844, 243.291, 245.668, 248.092, 250.564, 253.086, 255.537, 258.035, 260.583, 263.182, 265.707, 268.281, 270.906, 273.582, 276.199, 278.866, 281.586, 284.359, 287.054, 289.801, 292.600, 295.455, 298.229, 301.056, 303.937, 306.873, 309.728, 312.636, 315.599, 318.619, 321.555, 324.545, 327.592, 330.696, 333.748, 336.858, 340.026, 343.254, 346.391, 349.587, 352.842, 356.159, 359.383, 362.666, 366.010, 369.416, 372.727, 376.099, 379.532, 383.028, 386.428, 389.888, 393.411, 396.999, 400.561, 404.188, 407.880, 411.641, 415.297, 419.018, 422.807, 426.665, 430.415, 434.232, 438.118, 442.073, 445.919, 449.832, 453.815, 457.868, 461.810, 465.820, 469.900, 474.053, 477.831, 481.669, 485.569, 489.534, 493.394, 497.316, 501.301, 505.350, 509.293, 513.299, 517.368, 521.502, 525.529, 529.618, 533.771, 537.990, 542.100, 546.273, 550.510, 554.814, 559.185, 563.626, 568.138, 572.722, 577.185, 581.717, 586.322, 591.000, 595.553, 600.178, 604.874, 609.645, 614.289, 619.005, 623.793, 628.656, 633.390, 638.196, 643.076, 648.030, 652.922, 657.889, 662.931, 668.052, 673.036, 678.095, 683.230, 688.445, 693.520, 698.671, 703.899, 709.206, 714.372, 719.614, 724.933, 730.332, 735.587, 740.918, 746.328, 751.816, 757.184, 762.629, 768.152, 773.757, 779.213, 784.747, 790.360, 796.053, 801.596, 807.216, 812.916, 818.697, 824.326, 830.032, 835.819, 841.686, 847.399, 853.189, 859.060, 865.011, 870.923, 876.916, 882.992, 889.152, 895.149, 901.226, 907.387, 913.633, 919.712, 925.873, 932.117, 938.446, 944.607, 950.848, 957.173, 963.582, 969.821, 976.140, 982.542, 989.029, 995.149, 1001.345, 1007.619, 1013.972, 1020.162, 1026.428, 1032.772, 1039.194, 1045.449, 1051.779, 1058.186, 1064.672, 1070.992, 1077.387, 1083.860, 1090.410, 1096.790, 1103.245, 1109.777, 1116.386, 1122.986, 1129.665, 1136.424, 1143.264, 1149.924, 1156.661, 1163.479, 1170.377, 1177.093, 1183.886, 1190.759, 1197.711, 1204.483, 1211.333, 1218.260, 1225.267, 1232.091, 1238.992, 1245.970, 1253.027, 1259.911, 1266.871, 1273.909, 1281.025, 1287.953, 1294.957, 1302.038, 1309.197, 1316.169, 1323.215, 1330.338, 1337.538, 1344.550, 1351.637, 1358.799, 1366.037, 1373.085, 1380.207, 1387.403, 1394.674, 1401.858, 1409.117, 1416.452, 1423.863, 1431.081, 1438.372, 1445.738, 1453.180, 1460.425, 1467.742, 1475.133, 1482.598, 1489.866, 1497.205, 1504.617, 1512.103, 1519.394, 1526.755, 1534.188, 1541.693, 1548.833, 1556.040, 1563.314, 1570.656, 1577.808, 1585.026, 1592.311, 1599.663, 1606.821, 1614.043, 1621.331, 1628.685, 1635.856, 1643.090, 1650.388, 1657.752, 1664.922, 1672.155, 1679.450, 1686.810, 1693.619, 1700.484, 1707.404, 1714.381, 1721.184, 1728.042, 1734.954, 1741.922, 1748.720, 1755.571, 1762.476, 1769.435, 1776.224, 1783.066, 1789.960, 1796.908, 1803.682, 1810.507, 1817.383, 1824.313, 1831.552, 1838.849, 1846.205, 1853.619, 1860.837, 1868.112, 1875.443, 1882.832, 1890.034, 1897.291, 1904.604, 1911.974, 1919.156, 1926.393, 1933.685, 1941.032, 1948.184, 1955.389, 1962.647, 1969.959, 1977.087, 1984.267, 1991.500, 1998.785, 2005.883, 2013.032, 2020.232, 2027.484, 2034.546, 2041.657, 2048.819, 2056.030, 2063.061, 2070.139, 2077.267, 2084.443, 2091.431, 2098.466, 2105.548, 2112.678, 2119.624, 2126.615, 2133.652, 2140.736, 2147.633, 2154.576, 2161.563, 2168.595, 2175.452, 2182.353, 2189.298, 2196.287, 2203.093, 2209.943, 2216.834, 2223.769, 2230.528, 2237.328, 2244.169, 2251.053, 2258.250, 2265.493, 2272.784, 2280.121, 2287.254, 2294.432, 2301.655, 2308.924, 2316.002, 2323.124, 2330.289, 2337.499, 2344.511, 2351.565, 2358.661, 2365.801, 2372.750, 2379.739, 2386.771, 2393.843, 2400.187, 2406.565, 2412.976, 2419.422, 2425.703, 2432.017, 2438.365, 2444.745, 2450.964, 2457.214, 2463.497, 2469.811, 2475.967, 2482.154, 2488.372, 2494.621, 2500.715, 2506.838, 2512.992, 2519.175, 2525.506, 2531.868, 2538.262, 2544.689, 2550.937, 2557.216, 2563.525, 2569.866, 2576.058, 2582.279, 2588.530, 2594.812, 2600.922, 2607.061, 2613.229, 2619.427, 2625.466, 2631.532, 2637.627, 2643.750, 2649.719, 2655.715, 2661.739, 2667.789, 2673.691, 2679.619, 2685.574, 2691.555, 2697.373, 2703.217, 2709.086, 2714.981, 2720.728, 2726.500, 2732.296, 2738.117, 2743.787, 2749.480, 2755.197, 2760.938, 2766.643, 2772.372, 2778.125, 2783.901, 2789.530, 2795.181, 2800.856, 2806.553, 2812.110, 2817.688, 2823.289, 2828.912, 2834.380, 2839.869, 2845.379, 2850.911, 2856.305, 2861.720, 2867.156, 2872.612, 2877.841, 2883.090, 2888.358, 2893.645, 2898.798, 2903.970, 2909.161, 2914.370, 2919.454, 2924.556, 2929.675, 2934.812, 2939.811, 2944.826, 2949.859, 2954.908, 2959.839, 2964.786, 2969.749, 2974.730, 2979.115, 2983.514, 2987.926, 2992.351, 2996.684, 3001.029, 3005.387, 3009.758, 3014.012, 3018.278, 3022.556, 3026.846, 3031.052, 3035.271, 3039.501, 3043.743, 3047.876, 3052.021, 3056.176, 3060.343, 3064.851, 3069.372, 3073.907, 3078.455, 3082.893, 3087.344, 3091.807, 3096.284, 3100.636, 3105.000, 3109.377, 3113.766, 3118.054, 3122.354, 3126.665, 3130.989, 3135.209, 3139.441, 3143.684, 3147.939, 3152.167, 3156.406, 3160.656, 3164.918, 3169.061, 3173.215, 3177.380, 3181.555, 3185.636, 3189.728, 3193.830, 3197.943, 3201.946, 3205.960, 3209.984, 3214.017, 3217.954, 3221.900, 3225.855, 3229.820, 3233.741, 3237.671, 3241.611, 3245.561, 3249.424, 3253.296, 3257.178, 3261.068, 3264.858, 3268.656, 3272.463, 3276.279, 3279.992, 3283.713, 3287.443, 3291.181, 3294.830, 3298.486, 3302.150, 3305.823, 3309.575, 3313.335, 3317.104, 3320.881, 3324.567, 3328.261, 3331.963, 3335.673, 3339.290, 3342.915, 3346.548, 3350.189, 3353.735, 3357.289, 3360.851, 3364.420, 3367.893, 3371.374, 3374.862, 3378.357, 3381.518, 3384.684, 3387.857, 3391.035, 3394.130, 3397.231, 3400.337, 3403.448, 3406.490, 3409.538, 3412.591, 3415.649, 3418.637, 3421.630, 3424.629, 3427.633, 3430.550, 3433.472, 3436.399, 3439.332, 3442.561, 3445.797, 3449.039, 3452.287, 3455.433, 3458.584, 3461.741, 3464.904, 3467.994, 3471.090, 3474.192, 3477.299, 3480.317, 3483.340, 3486.369, 3489.403, 3492.363, 3495.328, 3498.298, 3501.273, 3503.887, 3506.504, 3509.125, 3511.751, 3514.315, 3516.884, 3519.457, 3522.033, 3524.548, 3527.067, 3529.590, 3532.116, 3534.581, 3537.049, 3539.521, 3541.996, 3544.410, 3546.827, 3549.247, 3551.670, 3554.310, 3556.954, 3559.602, 3562.254, 3564.827, 3567.404, 3569.984, 3572.569, 3575.091, 3577.616, 3580.145, 3582.677, 3585.130, 3587.586, 3590.045, 3592.508, 3594.923, 3597.342, 3599.764, 3602.190, 3604.348, 3606.510, 3608.674, 3610.840, 3612.958, 3615.079, 3617.202, 3619.328, 3621.405, 3623.484, 3625.566, 3627.651, 3629.686, 3631.723, 3633.763, 3635.806, 3637.798, 3639.793, 3641.791, 3643.790, 3645.567, 3647.346, 3649.127, 3650.910, 3652.642, 3654.376, 3656.111, 3657.848, 3659.552, 3661.258, 3662.965, 3664.674, 3666.349, 3668.026, 3669.705, 3671.385, 3673.014, 3674.644, 3676.276, 3677.909, 3679.755, 3681.603, 3683.453, 3685.304, 3687.122, 3688.942, 3690.763, 3692.587, 3694.359, 3696.132, 3697.908, 3699.685, 3701.410, 3703.137, 3704.866, 3706.596, 3708.292, 3709.990, 3711.689, 3713.390, 3715.128, 3716.868, 3718.609, 3720.353, 3722.043, 3723.736, 3725.429, 3727.125, 3728.786, 3730.448, 3732.112, 3733.777, 3735.407, 3737.039, 3738.673, 3740.307, 3741.889, 3743.472, 3745.056, 3746.642, 3748.211, 3749.781, 3751.352, 3752.925, 3754.462, 3756.001, 3757.541, 3759.082, 3760.588, 3762.095, 3763.603, 3765.112, 3766.586, 3768.061, 3769.537, 3771.014, 3772.455, 3773.898, 3775.341, 3776.786, 3778.194, 3779.604, 3781.015, 3782.427, 3783.802, 3785.179, 3786.557, 3787.935, 3789.259, 3790.584, 3791.909, 3793.236, 3794.563, 3795.892, 3797.221, 3798.551, 3799.826, 3801.102, 3802.379, 3803.656, 3804.916, 3806.176, 3807.437, 3808.699, 3809.943, 3811.188, 3812.434, 3813.680, 3814.890, 3816.100, 3817.311, 3818.523, 3819.697, 3820.873, 3822.049, 3823.226, 3824.384, 3825.543, 3826.703, 3827.864, 3829.006, 3830.149, 3831.293, 3832.437, 3833.563, 3834.690, 3835.817, 3836.945, 3838.035, 3839.126, 3840.218, 3841.310, 3842.384, 3843.458, 3844.533, 3845.608, 3846.665, 3847.722, 3848.780, 3849.839, 3850.860, 3851.881, 3852.902, 3853.925, 3854.928, 3855.932, 3856.937, 3857.942, 3858.947, 3859.953, 3860.960, 3861.967, 3862.936, 3863.906, 3864.875, 3865.846, 3866.797, 3867.749, 3868.702, 3869.654, 3870.588, 3871.523, 3872.457, 3873.393, 3874.309, 3875.225, 3876.142, 3877.060, 3877.958, 3878.857, 3879.756, 3880.656, 3881.536, 3882.417, 3883.298, 3884.180, 3885.042, 3885.905, 3886.768, 3887.632, 3888.476, 3889.321, 3890.166, 3891.012, 3891.838, 3892.664, 3893.491, 3894.318, 3895.146, 3895.974, 3896.802, 3897.631, 3898.420, 3899.210, 3900.000, 3900.790, 3901.581, 3902.372, 3903.164, 3903.955, 3904.708, 3905.461, 3906.214, 3906.967, 3907.740, 3908.514, 3909.288, 3910.062, 3910.797, 3911.532, 3912.268, 3913.004, 3913.720, 3914.436, 3915.153, 3915.870, 3916.587, 3917.304, 3918.022, 3918.740, 3919.438, 3920.137, 3920.836, 3921.535, 3922.214, 3922.893, 3923.573, 3924.253, 3924.933, 3925.614, 3926.295, 3926.976, 3927.637, 3928.298, 3928.960, 3929.621, 3930.263, 3930.906, 3931.548, 3932.191, 3932.833, 3933.476, 3934.120, 3934.763, 3935.387, 3936.010, 3936.634, 3937.258, 3937.863, 3938.467, 3939.071, 3939.676, 3940.281, 3940.886, 3941.491, 3942.097, 3942.682, 3943.268, 3943.854, 3944.440, 3945.026, 3945.612, 3946.199, 3946.786, 3947.352, 3947.919, 3948.486, 3949.053, 3949.600, 3950.147, 3950.695, 3951.242, 3951.790, 3952.337, 3952.885, 3953.433, 3953.982, 3954.530, 3955.079, 3955.627, 3956.156, 3956.684, 3957.213, 3957.742, 3958.271, 3958.800, 3959.330, 3959.859, 3960.369, 3960.878, 3961.387, 3961.897, 3962.387, 3962.876, 3963.366, 3963.855, 3964.345, 3964.835, 3965.325, 3965.816, 3966.306, 3966.797, 3967.287, 3967.778, 3968.248, 3968.719, 3969.189, 3969.660, 3970.131, 3970.602, 3971.073, 3971.544, 3971.995, 3972.446, 3972.897, 3973.348, 3973.799, 3974.250, 3974.702, 3975.153, 3975.584, 3976.016, 3976.447, 3976.878, 3977.310, 3977.741, 3978.173, 3978.605, 3979.036, 3979.468, 3979.900, 3980.333, 3980.744, 3981.156, 3981.568, 3981.980, 3982.392, 3982.804, 3983.216, 3983.628, 3984.020, 3984.411, 3984.803, 3985.195, 3985.608, 3986.021, 3986.433, 3986.846, 3987.218, 3987.590, 3987.961, 3988.333, 3988.726, 3989.119, 3989.511, 3989.904, 3990.276, 3990.649, 3991.021, 3991.394, 3991.766, 3992.139, 3992.511, 3992.884, 3993.236, 3993.588, 3993.941, 3994.293, 3994.645, 3994.998, 3995.350, 3995.703, 3996.055, 3996.408, 3996.760, 3997.113, 3997.466, 3997.819, 3998.172, 3998.525, 3998.857, 3999.190, 3999.522, 3999.855, 4000.187, 4000.520, 4000.852, 4001.185, 4001.518, 4001.851, 4002.183, 4002.516, 4002.828, 4003.141, 4003.453, 4003.765, 4004.078, 4004.390, 4004.702, 4005.015, ]
        channel = config.getint('channel', 0)
        SensorBase.__init__(self, config, "InovaV1", spi_mode=0, channel=channel, speed=1000000)
    
    def calc_temp(self, adc, fault):
        idx = min(range(len(self.resTable)), key=lambda i: abs(self.resTable[i] - adc))
        return self.tempTable[idx]

    def calc_adc(self, temp):
        idx = min(range(len(self.tempTable)), key=lambda i: abs(self.tempTable[i] - temp))
        return int(self.resTable[idx])

######################################################################
# InovaGATE1 (ADC128S102CIMTX 4k7)
######################################################################

class InovaGATE1(SensorBase):
    def __init__(self, config):
        self.tempTable = [-30, -29.75, -29.5, -29.25, -29, -28.75, -28.5, -28.25, -28, -27.75, -27.5, -27.25, -27, -26.75, -26.5, -26.25, -26, -25.75, -25.5, -25.25, -25, -24.75, -24.5, -24.25, -24, -23.75, -23.5, -23.25, -23, -22.75, -22.5, -22.25, -22, -21.75, -21.5, -21.25, -21, -20.75, -20.5, -20.25, -20, -19.75, -19.5, -19.25, -19, -18.75, -18.5, -18.25, -18, -17.75, -17.5, -17.25, -17, -16.75, -16.5, -16.25, -16, -15.75, -15.5, -15.25, -15, -14.75, -14.5, -14.25, -14, -13.75, -13.5, -13.25, -13, -12.75, -12.5, -12.25, -12, -11.75, -11.5, -11.25, -11, -10.75, -10.5, -10.25, -10, -9.75, -9.5, -9.25, -9, -8.75, -8.5, -8.25, -8, -7.75, -7.5, -7.25, -7, -6.75, -6.5, -6.25, -6, -5.75, -5.5, -5.25, -5, -4.75, -4.5, -4.25, -4, -3.75, -3.5, -3.25, -3, -2.75, -2.5, -2.25, -2, -1.75, -1.5, -1.25, -1, -0.75, -0.5, -0.25, 0, 0.25, 0.5, 0.75, 1, 1.25, 1.5, 1.75, 2, 2.25, 2.5, 2.75, 3, 3.25, 3.5, 3.75, 4, 4.25, 4.5, 4.75, 5, 5.25, 5.5, 5.75, 6, 6.25, 6.5, 6.75, 7, 7.25, 7.5, 7.75, 8, 8.25, 8.5, 8.75, 9, 9.25, 9.5, 9.75, 10, 10.25, 10.5, 10.75, 11, 11.25, 11.5, 11.75, 12, 12.25, 12.5, 12.75, 13, 13.25, 13.5, 13.75, 14, 14.25, 14.5, 14.75, 15, 15.25, 15.5, 15.75, 16, 16.25, 16.5, 16.75, 17, 17.25, 17.5, 17.75, 18, 18.25, 18.5, 18.75, 19, 19.25, 19.5, 19.75, 20, 20.25, 20.5, 20.75, 21, 21.25, 21.5, 21.75, 22, 22.25, 22.5, 22.75, 23, 23.25, 23.5, 23.75, 24, 24.25, 24.5, 24.75, 25, 25.25, 25.5, 25.75, 26, 26.25, 26.5, 26.75, 27, 27.25, 27.5, 27.75, 28, 28.25, 28.5, 28.75, 29, 29.25, 29.5, 29.75, 30, 30.25, 30.5, 30.75, 31, 31.25, 31.5, 31.75, 32, 32.25, 32.5, 32.75, 33, 33.25, 33.5, 33.75, 34, 34.25, 34.5, 34.75, 35, 35.25, 35.5, 35.75, 36, 36.25, 36.5, 36.75, 37, 37.25, 37.5, 37.75, 38, 38.25, 38.5, 38.75, 39, 39.25, 39.5, 39.75, 40, 40.25, 40.5, 40.75, 41, 41.25, 41.5, 41.75, 42, 42.25, 42.5, 42.75, 43, 43.25, 43.5, 43.75, 44, 44.25, 44.5, 44.75, 45, 45.25, 45.5, 45.75, 46, 46.25, 46.5, 46.75, 47, 47.25, 47.5, 47.75, 48, 48.25, 48.5, 48.75, 49, 49.25, 49.5, 49.75, 50, 50.25, 50.5, 50.75, 51, 51.25, 51.5, 51.75, 52, 52.25, 52.5, 52.75, 53, 53.25, 53.5, 53.75, 54, 54.25, 54.5, 54.75, 55, 55.25, 55.5, 55.75, 56, 56.25, 56.5, 56.75, 57, 57.25, 57.5, 57.75, 58, 58.25, 58.5, 58.75, 59, 59.25, 59.5, 59.75, 60, 60.25, 60.5, 60.75, 61, 61.25, 61.5, 61.75, 62, 62.25, 62.5, 62.75, 63, 63.25, 63.5, 63.75, 64, 64.25, 64.5, 64.75, 65, 65.25, 65.5, 65.75, 66, 66.25, 66.5, 66.75, 67, 67.25, 67.5, 67.75, 68, 68.25, 68.5, 68.75, 69, 69.25, 69.5, 69.75, 70, 70.25, 70.5, 70.75, 71, 71.25, 71.5, 71.75, 72, 72.25, 72.5, 72.75, 73, 73.25, 73.5, 73.75, 74, 74.25, 74.5, 74.75, 75, 75.25, 75.5, 75.75, 76, 76.25, 76.5, 76.75, 77, 77.25, 77.5, 77.75, 78, 78.25, 78.5, 78.75, 79, 79.25, 79.5, 79.75, 80, 80.25, 80.5, 80.75, 81, 81.25, 81.5, 81.75, 82, 82.25, 82.5, 82.75, 83, 83.25, 83.5, 83.75, 84, 84.25, 84.5, 84.75, 85, 85.25, 85.5, 85.75, 86, 86.25, 86.5, 86.75, 87, 87.25, 87.5, 87.75, 88, 88.25, 88.5, 88.75, 89, 89.25, 89.5, 89.75, 90, 90.25, 90.5, 90.75, 91, 91.25, 91.5, 91.75, 92, 92.25, 92.5, 92.75, 93, 93.25, 93.5, 93.75, 94, 94.25, 94.5, 94.75, 95, 95.25, 95.5, 95.75, 96, 96.25, 96.5, 96.75, 97, 97.25, 97.5, 97.75, 98, 98.25, 98.5, 98.75, 99, 99.25, 99.5, 99.75, 100, 100.25, 100.5, 100.75, 101, 101.25, 101.5, 101.75, 102, 102.25, 102.5, 102.75, 103, 103.25, 103.5, 103.75, 104, 104.25, 104.5, 104.75, 105, 105.25, 105.5, 105.75, 106, 106.25, 106.5, 106.75, 107, 107.25, 107.5, 107.75, 108, 108.25, 108.5, 108.75, 109, 109.25, 109.5, 109.75, 110, 110.25, 110.5, 110.75, 111, 111.25, 111.5, 111.75, 112, 112.25, 112.5, 112.75, 113, 113.25, 113.5, 113.75, 114, 114.25, 114.5, 114.75, 115, 115.25, 115.5, 115.75, 116, 116.25, 116.5, 116.75, 117, 117.25, 117.5, 117.75, 118, 118.25, 118.5, 118.75, 119, 119.25, 119.5, 119.75, 120, 120.25, 120.5, 120.75, 121, 121.25, 121.5, 121.75, 122, 122.25, 122.5, 122.75, 123, 123.25, 123.5, 123.75, 124, 124.25, 124.5, 124.75, 125, 125.25, 125.5, 125.75, 126, 126.25, 126.5, 126.75, 127, 127.25, 127.5, 127.75, 128, 128.25, 128.5, 128.75, 129, 129.25, 129.5, 129.75, 130, 130.25, 130.5, 130.75, 131, 131.25, 131.5, 131.75, 132, 132.25, 132.5, 132.75, 133, 133.25, 133.5, 133.75, 134, 134.25, 134.5, 134.75, 135, 135.25, 135.5, 135.75, 136, 136.25, 136.5, 136.75, 137, 137.25, 137.5, 137.75, 138, 138.25, 138.5, 138.75, 139, 139.25, 139.5, 139.75, 140, 140.25, 140.5, 140.75, 141, 141.25, 141.5, 141.75, 142, 142.25, 142.5, 142.75, 143, 143.25, 143.5, 143.75, 144, 144.25, 144.5, 144.75, 145, 145.25, 145.5, 145.75, 146, 146.25, 146.5, 146.75, 147, 147.25, 147.5, 147.75, 148, 148.25, 148.5, 148.75, 149, 149.25, 149.5, 149.75, 150, 150.25, 150.5, 150.75, 151, 151.25, 151.5, 151.75, 152, 152.25, 152.5, 152.75, 153, 153.25, 153.5, 153.75, 154, 154.25, 154.5, 154.75, 155, 155.25, 155.5, 155.75, 156, 156.25, 156.5, 156.75, 157, 157.25, 157.5, 157.75, 158, 158.25, 158.5, 158.75, 159, 159.25, 159.5, 159.75, 160, 160.25, 160.5, 160.75, 161, 161.25, 161.5, 161.75, 162, 162.25, 162.5, 162.75, 163, 163.25, 163.5, 163.75, 164, 164.25, 164.5, 164.75, 165, 165.25, 165.5, 165.75, 166, 166.25, 166.5, 166.75, 167, 167.25, 167.5, 167.75, 168, 168.25, 168.5, 168.75, 169, 169.25, 169.5, 169.75, 170, 170.25, 170.5, 170.75, 171, 171.25, 171.5, 171.75, 172, 172.25, 172.5, 172.75, 173, 173.25, 173.5, 173.75, 174, 174.25, 174.5, 174.75, 175, 175.25, 175.5, 175.75, 176, 176.25, 176.5, 176.75, 177, 177.25, 177.5, 177.75, 178, 178.25, 178.5, 178.75, 179, 179.25, 179.5, 179.75, 180, 180.25, 180.5, 180.75, 181, 181.25, 181.5, 181.75, 182, 182.25, 182.5, 182.75, 183, 183.25, 183.5, 183.75, 184, 184.25, 184.5, 184.75, 185, 185.25, 185.5, 185.75, 186, 186.25, 186.5, 186.75, 187, 187.25, 187.5, 187.75, 188, 188.25, 188.5, 188.75, 189, 189.25, 189.5, 189.75, 190, 190.25, 190.5, 190.75, 191, 191.25, 191.5, 191.75, 192, 192.25, 192.5, 192.75, 193, 193.25, 193.5, 193.75, 194, 194.25, 194.5, 194.75, 195, 195.25, 195.5, 195.75, 196, 196.25, 196.5, 196.75, 197, 197.25, 197.5, 197.75, 198, 198.25, 198.5, 198.75, 199, 199.25, 199.5, 199.75, 200, 200.25, 200.5, 200.75, 201, 201.25, 201.5, 201.75, 202, 202.25, 202.5, 202.75, 203, 203.25, 203.5, 203.75, 204, 204.25, 204.5, 204.75, 205, 205.25, 205.5, 205.75, 206, 206.25, 206.5, 206.75, 207, 207.25, 207.5, 207.75, 208, 208.25, 208.5, 208.75, 209, 209.25, 209.5, 209.75, 210, 210.25, 210.5, 210.75, 211, 211.25, 211.5, 211.75, 212, 212.25, 212.5, 212.75, 213, 213.25, 213.5, 213.75, 214, 214.25, 214.5, 214.75, 215, 215.25, 215.5, 215.75, 216, 216.25, 216.5, 216.75, 217, 217.25, 217.5, 217.75, 218, 218.25, 218.5, 218.75, 219, 219.25, 219.5, 219.75, 220, 220.25, 220.5, 220.75, 221, 221.25, 221.5, 221.75, 222, 222.25, 222.5, 222.75, 223, 223.25, 223.5, 223.75, 224, 224.25, 224.5, 224.75, 225, 225.25, 225.5, 225.75, 226, 226.25, 226.5, 226.75, 227, 227.25, 227.5, 227.75, 228, 228.25, 228.5, 228.75, 229, 229.25, 229.5, 229.75, 230, 230.25, 230.5, 230.75, 231, 231.25, 231.5, 231.75, 232, 232.25, 232.5, 232.75, 233, 233.25, 233.5, 233.75, 234, 234.25, 234.5, 234.75, 235, 235.25, 235.5, 235.75, 236, 236.25, 236.5, 236.75, 237, 237.25, 237.5, 237.75, 238, 238.25, 238.5, 238.75, 239, 239.25, 239.5, 239.75, 240, 240.25, 240.5, 240.75, 241, 241.25, 241.5, 241.75, 242, 242.25, 242.5, 242.75, 243, 243.25, 243.5, 243.75, 244, 244.25, 244.5, 244.75, 245, 245.25, 245.5, 245.75, 246, 246.25, 246.5, 246.75, 247, 247.25, 247.5, 247.75, 248, 248.25, 248.5, 248.75, 249, 249.25, 249.5, 249.75, 250, 250.25, 250.5, 250.75, 251, 251.25, 251.5, 251.75, 252, 252.25, 252.5, 252.75, 253, 253.25, 253.5, 253.75, 254, 254.25, 254.5, 254.75, 255, 255.25, 255.5, 255.75, 256, 256.25, 256.5, 256.75, 257, 257.25, 257.5, 257.75, 258, 258.25, 258.5, 258.75, 259, 259.25, 259.5, 259.75, 260, 260.25, 260.5, 260.75, 261, 261.25, 261.5, 261.75, 262, 262.25, 262.5, 262.75, 263, 263.25, 263.5, 263.75, 264, 264.25, 264.5, 264.75, 265, 265.25, 265.5, 265.75, 266, 266.25, 266.5, 266.75, 267, 267.25, 267.5, 267.75, 268, 268.25, 268.5, 268.75, 269, 269.25, 269.5, 269.75, 270, 270.25, 270.5, 270.75, 271, 271.25, 271.5, 271.75, 272, 272.25, 272.5, 272.75, 273, 273.25, 273.5, 273.75, 274, 274.25, 274.5, 274.75, 275, 275.25, 275.5, 275.75, 276, 276.25, 276.5, 276.75, 277, 277.25, 277.5, 277.75, 278, 278.25, 278.5, 278.75, 279, 279.25, 279.5, 279.75, 280, 280.25, 280.5, 280.75, 281, 281.25, 281.5, 281.75, 282, 282.25, 282.5, 282.75, 283, 283.25, 283.5, 283.75, 284, 284.25, 284.5, 284.75, 285, 285.25, 285.5, 285.75, 286, 286.25, 286.5, 286.75, 287, 287.25, 287.5, 287.75, 288, 288.25, 288.5, 288.75, 289, 289.25, 289.5, 289.75, 290, 290.25, 290.5, 290.75, 291, 291.25, 291.5, 291.75, 292, 292.25, 292.5, 292.75, 293, 293.25, 293.5, 293.75, 294, 294.25, 294.5, 294.75, 295, 295.25, 295.5, 295.75, 296, 296.25, 296.5, 296.75, 297, 297.25, 297.5, 297.75, 298, 298.25, 298.5, 298.75, 299, 299.25, 299.5, 299.75, 300, ]
        self.resTable = [4083.925, 4083.759, 4083.588, 4083.411, 4083.229, 4083.054, 4082.873, 4082.687, 4082.496, 4082.311, 4082.121, 4081.925, 4081.723, 4081.528, 4081.328, 4081.122, 4080.909, 4080.705, 4080.494, 4080.277, 4080.054, 4079.837, 4079.613, 4079.383, 4079.147, 4078.918, 4078.684, 4078.442, 4078.193, 4077.953, 4077.706, 4077.452, 4077.190, 4076.938, 4076.678, 4076.411, 4076.136, 4075.871, 4075.599, 4075.318, 4075.030, 4074.751, 4074.465, 4074.170, 4073.867, 4073.574, 4073.273, 4072.964, 4072.646, 4072.339, 4072.024, 4071.699, 4071.366, 4071.044, 4070.713, 4070.373, 4070.024, 4069.686, 4069.339, 4068.983, 4068.617, 4068.258, 4067.889, 4067.510, 4067.121, 4066.745, 4066.358, 4065.961, 4065.553, 4065.159, 4064.754, 4064.338, 4063.910, 4063.498, 4063.074, 4062.638, 4062.191, 4061.759, 4061.315, 4060.859, 4060.391, 4059.938, 4059.473, 4058.996, 4058.506, 4058.033, 4057.547, 4057.048, 4056.535, 4056.040, 4055.532, 4055.010, 4054.475, 4053.957, 4053.426, 4052.881, 4052.322, 4051.781, 4051.227, 4050.658, 4050.074, 4049.499, 4048.909, 4048.304, 4047.683, 4047.082, 4046.466, 4045.834, 4045.186, 4044.559, 4043.915, 4043.256, 4042.578, 4041.924, 4041.252, 4040.564, 4039.857, 4039.174, 4038.473, 4037.755, 4037.018, 4036.302, 4035.568, 4034.815, 4034.043, 4033.296, 4032.531, 4031.746, 4030.941, 4030.162, 4029.365, 4028.547, 4027.708, 4026.897, 4026.065, 4025.213, 4024.340, 4023.495, 4022.629, 4021.742, 4020.832, 4019.949, 4019.044, 4018.118, 4017.168, 4016.248, 4015.307, 4014.342, 4013.354, 4012.397, 4011.418, 4010.415, 4009.387, 4008.391, 4007.373, 4006.329, 4005.261, 4004.226, 4003.167, 4002.083, 4000.972, 3999.877, 3998.755, 3997.606, 3996.430, 3995.291, 3994.125, 3992.931, 3991.709, 3990.524, 3989.312, 3988.072, 3986.802, 3985.571, 3984.312, 3983.024, 3981.706, 3980.427, 3979.120, 3977.783, 3976.414, 3975.089, 3973.734, 3972.348, 3970.929, 3969.554, 3968.148, 3966.710, 3965.240, 3963.813, 3962.355, 3960.864, 3959.340, 3957.861, 3956.349, 3954.804, 3953.224, 3951.691, 3950.125, 3948.524, 3946.887, 3945.278, 3943.633, 3941.952, 3940.233, 3938.566, 3936.862, 3935.121, 3933.341, 3931.614, 3929.849, 3928.046, 3926.204, 3924.416, 3922.589, 3920.724, 3918.817, 3916.967, 3915.077, 3913.147, 3911.175, 3909.321, 3907.430, 3905.499, 3903.529, 3901.615, 3899.662, 3897.669, 3895.635, 3893.659, 3891.644, 3889.588, 3887.489, 3885.450, 3883.371, 3881.250, 3879.086, 3876.983, 3874.838, 3872.651, 3870.420, 3868.186, 3865.907, 3863.582, 3861.210, 3858.905, 3856.554, 3854.156, 3851.709, 3849.332, 3846.908, 3844.436, 3841.914, 3839.463, 3836.965, 3834.417, 3831.818, 3829.293, 3826.719, 3824.094, 3821.418, 3818.801, 3816.134, 3813.414, 3810.641, 3807.946, 3805.199, 3802.400, 3799.545, 3796.771, 3793.944, 3791.063, 3788.127, 3785.272, 3782.364, 3779.401, 3776.381, 3773.445, 3770.455, 3767.408, 3764.304, 3761.252, 3758.142, 3754.974, 3751.746, 3748.609, 3745.413, 3742.158, 3738.841, 3735.617, 3732.334, 3728.990, 3725.584, 3722.273, 3718.901, 3715.468, 3711.972, 3708.572, 3705.112, 3701.589, 3698.001, 3694.439, 3690.812, 3687.120, 3683.359, 3679.703, 3675.982, 3672.193, 3668.335, 3664.585, 3660.768, 3656.882, 3652.927, 3649.081, 3645.168, 3641.185, 3637.132, 3633.190, 3629.180, 3625.100, 3620.947, 3617.169, 3613.331, 3609.431, 3605.466, 3601.606, 3597.684, 3593.699, 3589.650, 3585.707, 3581.701, 3577.632, 3573.498, 3569.471, 3565.382, 3561.229, 3557.010, 3552.900, 3548.727, 3544.490, 3540.186, 3535.815, 3531.374, 3526.862, 3522.278, 3517.815, 3513.283, 3508.678, 3504.000, 3499.447, 3494.822, 3490.126, 3485.355, 3480.711, 3475.995, 3471.207, 3466.344, 3461.610, 3456.804, 3451.924, 3446.970, 3442.078, 3437.111, 3432.069, 3426.948, 3421.964, 3416.905, 3411.770, 3406.555, 3401.480, 3396.329, 3391.101, 3385.794, 3380.628, 3375.386, 3370.067, 3364.668, 3359.413, 3354.082, 3348.672, 3343.184, 3337.816, 3332.371, 3326.848, 3321.243, 3315.787, 3310.253, 3304.640, 3298.947, 3293.404, 3287.784, 3282.084, 3276.303, 3270.674, 3264.968, 3259.181, 3253.314, 3247.601, 3241.811, 3235.940, 3229.989, 3224.077, 3218.084, 3212.008, 3205.848, 3199.851, 3193.774, 3187.613, 3181.367, 3175.288, 3169.127, 3162.883, 3156.554, 3150.393, 3144.152, 3137.827, 3131.418, 3125.179, 3118.860, 3112.458, 3105.971, 3099.851, 3093.655, 3087.381, 3081.028, 3074.838, 3068.572, 3062.228, 3055.806, 3049.551, 3043.221, 3036.814, 3030.328, 3024.008, 3017.613, 3011.140, 3004.590, 2998.210, 2991.755, 2985.223, 2978.614, 2972.014, 2965.335, 2958.576, 2951.736, 2945.076, 2938.339, 2931.521, 2924.623, 2917.907, 2911.114, 2904.241, 2897.289, 2890.517, 2883.667, 2876.740, 2869.733, 2862.909, 2856.008, 2849.030, 2841.973, 2835.089, 2828.129, 2821.091, 2813.975, 2807.047, 2800.043, 2792.962, 2785.803, 2778.831, 2771.785, 2764.662, 2757.462, 2750.450, 2743.363, 2736.201, 2728.963, 2721.915, 2714.793, 2707.597, 2700.326, 2693.142, 2685.883, 2678.548, 2671.137, 2663.919, 2656.628, 2649.262, 2641.820, 2634.575, 2627.258, 2619.867, 2612.402, 2605.134, 2597.795, 2590.383, 2582.897, 2575.606, 2568.245, 2560.812, 2553.307, 2546.167, 2538.960, 2531.686, 2524.344, 2517.192, 2509.974, 2502.689, 2495.337, 2488.179, 2480.957, 2473.669, 2466.315, 2459.144, 2451.910, 2444.612, 2437.248, 2430.078, 2422.845, 2415.550, 2408.190, 2401.381, 2394.516, 2387.596, 2380.619, 2373.816, 2366.958, 2360.046, 2353.078, 2346.280, 2339.429, 2332.524, 2325.565, 2318.776, 2311.934, 2305.040, 2298.092, 2291.318, 2284.493, 2277.617, 2270.687, 2263.448, 2256.151, 2248.795, 2241.381, 2234.163, 2226.888, 2219.557, 2212.168, 2204.966, 2197.709, 2190.396, 2183.026, 2175.844, 2168.607, 2161.315, 2153.968, 2146.816, 2139.611, 2132.353, 2125.041, 2117.913, 2110.733, 2103.500, 2096.215, 2089.117, 2081.968, 2074.768, 2067.516, 2060.454, 2053.343, 2046.181, 2038.970, 2031.939, 2024.861, 2017.733, 2010.557, 2003.569, 1996.534, 1989.452, 1982.322, 1975.376, 1968.385, 1961.348, 1954.264, 1947.367, 1940.424, 1933.437, 1926.405, 1919.548, 1912.647, 1905.702, 1898.713, 1891.907, 1885.057, 1878.166, 1871.231, 1864.472, 1857.672, 1850.831, 1843.947, 1836.750, 1829.507, 1822.216, 1814.879, 1807.746, 1800.568, 1793.345, 1786.076, 1778.998, 1771.876, 1764.711, 1757.501, 1750.489, 1743.435, 1736.339, 1729.199, 1722.250, 1715.261, 1708.229, 1701.157, 1694.813, 1688.435, 1682.024, 1675.578, 1669.297, 1662.983, 1656.635, 1650.255, 1644.036, 1637.786, 1631.503, 1625.189, 1619.033, 1612.846, 1606.628, 1600.379, 1594.285, 1588.162, 1582.008, 1575.825, 1569.494, 1563.132, 1556.738, 1550.311, 1544.063, 1537.784, 1531.475, 1525.134, 1518.942, 1512.721, 1506.470, 1500.188, 1494.078, 1487.939, 1481.771, 1475.573, 1469.534, 1463.468, 1457.373, 1451.250, 1445.281, 1439.285, 1433.261, 1427.211, 1421.309, 1415.381, 1409.426, 1403.445, 1397.627, 1391.783, 1385.914, 1380.019, 1374.272, 1368.500, 1362.704, 1356.883, 1351.213, 1345.520, 1339.803, 1334.062, 1328.357, 1322.628, 1316.875, 1311.099, 1305.470, 1299.819, 1294.144, 1288.447, 1282.890, 1277.312, 1271.711, 1266.088, 1260.620, 1255.131, 1249.621, 1244.089, 1238.695, 1233.280, 1227.844, 1222.388, 1217.159, 1211.910, 1206.642, 1201.355, 1196.202, 1191.030, 1185.839, 1180.630, 1175.546, 1170.444, 1165.325, 1160.188, 1155.189, 1150.174, 1145.141, 1140.092, 1135.161, 1130.214, 1125.251, 1120.270, 1115.885, 1111.486, 1107.074, 1102.649, 1098.316, 1093.971, 1089.613, 1085.242, 1080.988, 1076.722, 1072.444, 1068.154, 1063.948, 1059.729, 1055.499, 1051.257, 1047.124, 1042.979, 1038.824, 1034.657, 1030.149, 1025.628, 1021.093, 1016.545, 1012.107, 1007.656, 1003.193, 998.716, 994.364, 990.000, 985.623, 981.234, 976.946, 972.646, 968.335, 964.011, 959.791, 955.559, 951.316, 947.061, 942.833, 938.594, 934.344, 930.082, 925.939, 921.785, 917.620, 913.445, 909.364, 905.272, 901.170, 897.057, 893.054, 889.040, 885.016, 880.983, 877.046, 873.100, 869.145, 865.180, 861.259, 857.329, 853.389, 849.439, 845.576, 841.704, 837.822, 833.932, 830.142, 826.344, 822.537, 818.721, 815.008, 811.287, 807.557, 803.819, 800.170, 796.514, 792.850, 789.177, 785.425, 781.665, 777.896, 774.119, 770.433, 766.739, 763.037, 759.327, 755.710, 752.085, 748.452, 744.811, 741.265, 737.711, 734.149, 730.580, 727.107, 723.626, 720.138, 716.643, 713.482, 710.316, 707.143, 703.965, 700.870, 697.769, 694.663, 691.552, 688.510, 685.462, 682.409, 679.351, 676.363, 673.370, 670.371, 667.367, 664.450, 661.528, 658.601, 655.668, 652.439, 649.203, 645.961, 642.713, 639.567, 636.416, 633.259, 630.096, 627.006, 623.910, 620.808, 617.701, 614.683, 611.660, 608.631, 605.597, 602.637, 599.672, 596.702, 593.727, 591.113, 588.496, 585.875, 583.249, 580.685, 578.116, 575.543, 572.967, 570.452, 567.933, 565.410, 562.884, 560.419, 557.951, 555.479, 553.004, 550.590, 548.173, 545.753, 543.330, 540.690, 538.046, 535.398, 532.746, 530.173, 527.596, 525.016, 522.431, 519.909, 517.384, 514.855, 512.323, 509.870, 507.414, 504.955, 502.492, 500.077, 497.658, 495.236, 492.810, 490.652, 488.490, 486.326, 484.160, 482.042, 479.921, 477.798, 475.672, 473.595, 471.516, 469.434, 467.349, 465.314, 463.277, 461.237, 459.194, 457.202, 455.207, 453.209, 451.210, 449.433, 447.654, 445.873, 444.090, 442.358, 440.624, 438.889, 437.152, 435.448, 433.742, 432.035, 430.326, 428.651, 426.974, 425.295, 423.615, 421.986, 420.356, 418.724, 417.091, 415.245, 413.397, 411.547, 409.696, 407.878, 406.058, 404.237, 402.413, 400.641, 398.868, 397.092, 395.315, 393.590, 391.863, 390.134, 388.404, 386.708, 385.010, 383.311, 381.610, 379.872, 378.132, 376.391, 374.647, 372.957, 371.264, 369.571, 367.875, 366.214, 364.552, 362.888, 361.223, 359.593, 357.961, 356.327, 354.693, 353.111, 351.528, 349.944, 348.358, 346.789, 345.219, 343.648, 342.075, 340.538, 338.999, 337.459, 335.918, 334.412, 332.905, 331.397, 329.888, 328.414, 326.939, 325.463, 323.986, 322.545, 321.102, 319.659, 318.214, 316.806, 315.396, 313.985, 312.573, 311.198, 309.821, 308.443, 307.065, 305.741, 304.416, 303.091, 301.764, 300.437, 299.108, 297.779, 296.449, 295.174, 293.898, 292.621, 291.344, 290.084, 288.824, 287.563, 286.301, 285.057, 283.812, 282.566, 281.320, 280.110, 278.900, 277.689, 276.477, 275.303, 274.127, 272.951, 271.774, 270.616, 269.457, 268.297, 267.136, 265.994, 264.851, 263.707, 262.563, 261.437, 260.310, 259.183, 258.055, 256.965, 255.874, 254.782, 253.690, 252.616, 251.542, 250.467, 249.392, 248.335, 247.278, 246.220, 245.161, 244.140, 243.119, 242.098, 241.075, 240.072, 239.068, 238.063, 237.058, 236.053, 235.047, 234.040, 233.033, 232.064, 231.094, 230.125, 229.154, 228.203, 227.251, 226.298, 225.346, 224.412, 223.477, 222.543, 221.607, 220.691, 219.775, 218.858, 217.940, 217.042, 216.143, 215.244, 214.344, 213.464, 212.583, 211.702, 210.820, 209.958, 209.095, 208.232, 207.368, 206.524, 205.679, 204.834, 203.988, 203.162, 202.336, 201.509, 200.682, 199.854, 199.026, 198.198, 197.369, 196.580, 195.790, 195.000, 194.210, 193.419, 192.628, 191.836, 191.045, 190.292, 189.539, 188.786, 188.033, 187.260, 186.486, 185.712, 184.938, 184.203, 183.468, 182.732, 181.996, 181.280, 180.564, 179.847, 179.130, 178.413, 177.696, 176.978, 176.260, 175.562, 174.863, 174.164, 173.465, 172.786, 172.107, 171.427, 170.747, 170.067, 169.386, 168.705, 168.024, 167.363, 166.702, 166.040, 165.379, 164.737, 164.094, 163.452, 162.809, 162.167, 161.524, 160.880, 160.237, 159.613, 158.990, 158.366, 157.742, 157.137, 156.533, 155.929, 155.324, 154.719, 154.114, 153.509, 152.903, 152.318, 151.732, 151.146, 150.560, 149.974, 149.388, 148.801, 148.214, 147.648, 147.081, 146.514, 145.947, 145.400, 144.853, 144.305, 143.758, 143.210, 142.663, 142.115, 141.567, 141.018, 140.470, 139.921, 139.373, 138.844, 138.316, 137.787, 137.258, 136.729, 136.200, 135.670, 135.141, 134.631, 134.122, 133.613, 133.103, 132.613, 132.124, 131.634, 131.145, 130.655, 130.165, 129.675, 129.184, 128.694, 128.203, 127.713, 127.222, 126.752, 126.281, 125.811, 125.340, 124.869, 124.398, 123.927, 123.456, 123.005, 122.554, 122.103, 121.652, 121.201, 120.750, 120.298, 119.847, 119.416, 118.984, 118.553, 118.122, 117.690, 117.259, 116.827, 116.395, 115.964, 115.532, 115.100, 114.667, 114.256, 113.844, 113.432, 113.020, 112.608, 112.196, 111.784, 111.372, 110.980, 110.589, 110.197, 109.805, 109.392, 108.979, 108.567, 108.154, 107.782, 107.410, 107.039, 106.667, 106.274, 105.881, 105.489, 105.096, 104.724, 104.351, 103.979, 103.606, 103.234, 102.861, 102.489, 102.116, 101.764, 101.412, 101.059, 100.707, 100.355, 100.002, 99.650, 99.297, 98.945, 98.592, 98.240, 97.887, 97.534, 97.181, 96.828, 96.475, 96.143, 95.810, 95.478, 95.145, 94.813, 94.480, 94.148, 93.815, 93.482, 93.149, 92.817, 92.484, 92.172, 91.859, 91.547, 91.235, 90.922, 90.610, 90.298, 89.985, ]
        channel = config.getint('channel', 0)
        spi_speed = config.getint('spi_speed', 15000000)
        SensorBase.__init__(self, config, "InovaGATE1", spi_mode=0, channel=channel, speed=spi_speed)
    
    def calc_temp(self, adc, fault):
        idx = min(range(len(self.resTable)), key=lambda i: abs(self.resTable[i] - adc))
        return self.tempTable[idx]

    def calc_adc(self, temp):
        idx = min(range(len(self.tempTable)), key=lambda i: abs(self.tempTable[i] - temp))
        return int(self.resTable[idx])

######################################################################
# Sensor registration
######################################################################

Sensors = {
    "MAX6675": MAX6675,
    "MAX31855": MAX31855,
    "MAX31856": MAX31856,
    "MAX31865": MAX31865,
    "InovaV1": InovaV1,
    "InovaGATE1": InovaGATE1,
}

def load_config(config):
    # Register sensors
    pheaters = config.get_printer().load_object(config, "heaters")
    for name, klass in Sensors.items():
        pheaters.add_sensor_factory(name, klass)
